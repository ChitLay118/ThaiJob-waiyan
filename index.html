<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äõ·Ä±·Ä∏</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans Myanmar', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }
        
        .gradient-bg {
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%);
        }
        
        .gradient-bg-green {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-bg-purple {
            background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .gradient-bg-orange {
            background: linear-gradient(90deg, #f97316 0%, #ea580c 100%);
        }
        
        .gradient-bg-red {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }
        
        .gradient-bg-yellow {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }
        
        .shadow-neumorphism {
            box-shadow: 10px 10px 20px #0f172a, -10px -10px 20px #334155;
        }
        
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 3px;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .job-card {
            transition: all 0.3s ease;
            border-left: 4px solid #3b82f6;
        }
        
        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.4);
        }
        
        .status-approved {
            background-color: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }
        
        .status-denied {
            background-color: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }
        
        .nav-item {
            transition: all 0.2s ease;
            position: relative;
        }
        
        .nav-item.active {
            color: #3b82f6;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background-color: #3b82f6;
            border-radius: 3px;
        }
        
        .input-field {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 10px;
            color: white;
            transition: all 0.3s;
        }
        
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1e293b;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .loader {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- App Container -->
    <div id="app" class="flex-grow flex flex-col max-w-lg mx-auto w-full relative">
        
        <!-- Header -->
        <header class="gradient-bg p-4 text-white shadow-lg sticky top-0 z-20">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="bg-white p-2 rounded-full">
                        <i class="fas fa-briefcase text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äõ·Ä±·Ä∏</h1>
                        <p class="text-xs opacity-80">Thai Myanmar Job Portal</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="report-btn" onclick="showReportModal()" class="bg-white text-blue-600 text-sm px-3 py-1 rounded-full font-semibold hover:bg-blue-50 transition">
                        <i class="fas fa-flag mr-1"></i>·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·Äº·Ä¨·Ä∏·Äõ·Äî·Ä∫
                    </button>
                    <button id="logout-btn" onclick="handleLogout()" class="bg-red-500 text-white text-sm px-3 py-1 rounded-full font-semibold hover:bg-red-600 transition hidden">
                        <i class="fas fa-sign-out-alt mr-1"></i>·Äë·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫
                    </button>
                </div>
            </div>
            <div id="user-info-bar" class="mt-2 text-sm bg-blue-800 bg-opacity-30 p-2 rounded-lg hidden">
                <div class="flex justify-between items-center">
                    <div>
                        <i class="fas fa-user-circle mr-2"></i>
                        <span id="user-email-display" class="font-medium"></span>
                    </div>
                    <span id="user-id-display" class="text-xs opacity-70 bg-black bg-opacity-30 px-2 py-1 rounded"></span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="content" class="flex-grow p-4 overflow-y-auto scrollbar-thin">
            <!-- Loading Spinner -->
            <div id="loading-spinner" class="flex justify-center items-center h-full">
                <div class="text-center">
                    <div class="loader mx-auto mb-4"></div>
                    <p class="text-gray-400">·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äî·Ä±·Äû·Ää·Ä∫...</p>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav id="main-nav" class="glass-card p-2 mx-4 mb-4 rounded-2xl shadow-lg sticky bottom-4 z-10 hidden">
            <div class="flex justify-around">
                <!-- Home -->
                <button onclick="setView('home')" class="nav-item flex flex-col items-center p-3 w-1/5 text-gray-400">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">·Äô·Ä∞·Äú</span>
                </button>
                
                <!-- Notifications -->
                <button onclick="setView('notifications')" class="nav-item flex flex-col items-center p-3 w-1/5 text-gray-400 relative">
                    <i class="fas fa-bell text-xl mb-1"></i>
                    <span class="text-xs">·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫</span>
                    <div id="notification-badge" class="notification-badge hidden">0</div>
                </button>
                
                <!-- Car Rental -->
                <button onclick="setView('carRental')" class="nav-item flex flex-col items-center p-3 w-1/5 text-gray-400">
                    <i class="fas fa-car text-xl mb-1"></i>
                    <span class="text-xs">·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äõ·Äî·Ä∫</span>
                </button>
                
                <!-- Post Job -->
                <button id="post-job-nav-btn" onclick="setView('post')" class="nav-item flex flex-col items-center p-3 w-1/5 text-gray-400 hidden">
                    <i class="fas fa-plus-circle text-xl mb-1"></i>
                    <span class="text-xs">·Ä°·Äú·ÄØ·Äï·Ä∫·Äê·ÄÑ·Ä∫</span>
                </button>
                
                <!-- Profile -->
                <button onclick="setView('profile')" class="nav-item flex flex-col items-center p-3 w-1/5 text-gray-400">
                    <i class="fas fa-user text-xl mb-1"></i>
                    <span class="text-xs">·Äï·Äõ·Ä≠·ÄØ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫</span>
                </button>
            </div>
        </nav>

    </div>

    <!-- Firebase & Cloudinary Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, where, addDoc, updateDoc, getDocs, getDoc, deleteDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- CONSTANTS ---
        const ADMIN_EMAIL = 'thaimyanmarjob52@gmail.com';
        const CLOUDINARY_CLOUD_NAME = 'drz7nzbed';
        const CLOUDINARY_UPLOAD_PRESET = 'ThaiMyanmarJob';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtQObOg8Kk9VgnlIJ0TeyWJIhdynOpk8w",
            authDomain: "thaimyanmarjob-c4e76.firebaseapp.com",
            projectId: "thaimyanmarjob-c4e76",
            storageBucket: "thaimyanmarjob-c4e76.firebasestorage.app",
            messagingSenderId: "519311951526",
            appId: "1:519311951526:web:6ef1d02a6391abd50cd667",
            measurementId: "G-41WKEWBQL0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Global Variables
        let currentUserId = null;
        let currentUserEmail = null;
        let currentUserProfile = null;
        let isUserAdmin = false;
        let pendingUsersList = [];
        let myPostedJobsList = [];
        let approvedUsersList = [];
        let carRentalList = [];
        let adminReportLinks = {};
        let isAuthReady = false;

        // File state variables
        let selectedPassportFile = null;
        let selectedUserPhotoFile = null;
        let selectedJobImages = [];

        // Cache for public contact info
        window.publicContactsCache = {};

        // DOM Elements
        const contentDiv = document.getElementById('content');
        const loadingSpinner = document.getElementById('loading-spinner');
        const userIdDisplay = document.getElementById('user-id-display');
        const userEmailDisplay = document.getElementById('user-email-display');
        const postJobNavBtn = document.getElementById('post-job-nav-btn');
        const mainNav = document.getElementById('main-nav');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfoBar = document.getElementById('user-info-bar');
        const notificationBadge = document.getElementById('notification-badge');

        // State
        let currentView = 'home';

        // Utility Functions
        function showLoading() {
            contentDiv.innerHTML = '';
            loadingSpinner.classList.remove('hidden');
        }

        function hideLoading() {
            loadingSpinner.classList.add('hidden');
        }

        function logStatus(message, isError = false) {
            console.log(`[${isError ? 'ERROR' : 'STATUS'}] ${message}`);
        }

        function updateNotificationBadge() {
            if (window.notificationsList && window.notificationsList.length > 0) {
                notificationBadge.textContent = window.notificationsList.length;
                notificationBadge.classList.remove('hidden');
            } else {
                notificationBadge.classList.add('hidden');
            }
        }

        function updateActiveNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'text-blue-500');
                item.classList.add('text-gray-400');
            });
            
            const activeBtn = document.querySelector(`.nav-item[onclick="setView('${currentView}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-blue-500');
                activeBtn.classList.remove('text-gray-400');
            }
        }

        // Cloudinary Upload
        async function uploadToCloudinary(file) {
            if (!file) return null;

            const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`;
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Cloudinary upload failed: ${errorData.error.message}`);
                }

                const result = await response.json();
                return result.secure_url;
            } catch (error) {
                logStatus(`Cloudinary Upload Error: ${error.message}`, true);
                throw new Error('·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã');
            }
        }

        // Initialize Firebase and Authentication
        async function initFirebase() {
            try {
                logStatus("Firebase Initializing...");

                onAuthStateChanged(auth, async (user) => {
                    isAuthReady = true;
                    if (user) {
                        currentUserId = user.uid;
                        currentUserEmail = user.email;
                        isUserAdmin = user.email === ADMIN_EMAIL;
                        
                        userInfoBar.classList.remove('hidden');
                        userEmailDisplay.textContent = currentUserEmail;
                        userIdDisplay.textContent = `UID: ${currentUserId.substring(0, 6)}...`;
                        logoutBtn.classList.remove('hidden');
                        mainNav.classList.remove('hidden');

                        logStatus(`User Authenticated: ${currentUserEmail} (Admin: ${isUserAdmin})`);
                        await setupFirestoreListeners();
                    } else {
                        currentUserId = null;
                        currentUserEmail = null;
                        currentUserProfile = null;
                        isUserAdmin = false;
                        
                        userInfoBar.classList.add('hidden');
                        logoutBtn.classList.add('hidden');
                        mainNav.classList.add('hidden');
                        
                        logStatus("No user signed in.");
                    }
                    renderCurrentView();
                });

            } catch (error) {
                logStatus(`Firebase Initialization Failed: ${error.message}`, true);
                hideLoading();
                contentDiv.innerHTML = '<p class="text-red-400 text-center">Firebase ·ÄÖ·Äê·ÄÑ·Ä∫·Äô·Äæ·ÄØ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Åã</p>';
            }
        }

        // Logout Function
        window.handleLogout = async function() {
            try {
                await signOut(auth);
                showAlert('·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·ÄΩ·Ä¨·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏', '·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨ ·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·ÄΩ·Ä¨·ÄÅ·Ä≤·Ä∑·Äï·Ä´·Äï·Äº·ÄÆ·Åã', 'success');
            } catch (error) {
                logStatus(`Logout Failed: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', `·Äë·ÄΩ·ÄÄ·Ä∫·ÄÅ·ÄΩ·Ä¨·Åç ·Äô·Äõ·Äï·Ä´·Åã: ${error.message}`, 'error');
            }
        }

        // Authentication Handler
        window.handleAuth = async function(event, isSignup) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = isSignup ? document.getElementById('name').value : '';

            if (password.length < 6) {
                return showAlert('·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏', '·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫ ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÜ ·Äú·ÄØ·Ä∂·Ä∏·Äõ·Äæ·Ä≠·Äõ·Äô·Ää·Ä∫·Åã', 'error');
            }

            if (isSignup && !name) {
                return showAlert('·Ä°·Äô·Ää·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Ä°·Äô·Ää·Ä∫ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã', 'error');
            }

            try {
                if (isSignup) {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const userId = userCredential.user.uid;
                    
                    // Save user name to Firestore
                    const userDocRef = doc(db, `users/${userId}`);
                    await setDoc(userDocRef, {
                        name: name,
                        email: email,
                        createdAt: serverTimestamp()
                    }, { merge: true });
                    
                    showAlert('·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã ·ÄÄ·Äª·Ä±·Ä∏·Äá·Ä∞·Ä∏·Äï·Äº·ÄØ·Åç ·Äû·ÄÑ·Ä∑·Ä∫·Äï·Äõ·Ä≠·ÄØ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äï·Ä´·Åã', 'success');
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                    showAlert('·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏ ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·ÄÖ·ÄΩ·Ä¨ ·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·ÄÅ·Ä≤·Ä∑·Äï·Ä´·Äï·Äº·ÄÆ·Åã', 'success');
                }
            } catch (error) {
                let msg = error.message;
                if (error.code === 'auth/email-already-in-use') msg = '·Ä§·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äõ·Äæ·Ä≠·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã';
                if (error.code === 'auth/invalid-email') msg = '·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫·Äï·ÄØ·Ä∂·ÄÖ·Ä∂ ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´·Åã';
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') msg = '·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫ ·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã';
                
                logStatus(`Auth Error: ${error.message}`, true);
                showAlert('Auth ·Ä°·Äô·Äæ·Ä¨·Ä∏', msg, 'error');
            }
        }

        // Firestore Listeners Setup
        async function setupFirestoreListeners() {
            if (!currentUserId || !db) return;

            // 1. Listen for current user profile
            const userDocRef = doc(db, `artifacts/${app.options.projectId}/users/${currentUserId}/profile/data`);
            onSnapshot(userDocRef, (docSnap) => {
                currentUserProfile = docSnap.exists() ? docSnap.data() : null;
                logStatus(`User profile updated. Status: ${currentUserProfile ? currentUserProfile.status : 'N/A'}`);
                updateUIBasedOnProfile();
                if (currentView === 'profile') renderRegistrationProfile();
            });

            // 2. Listen for user's posted jobs
            const myJobsColRef = collection(db, `artifacts/${app.options.projectId}/public/data/jobs`);
            const myJobsQuery = query(myJobsColRef, where("postedBy", "==", currentUserId));
            onSnapshot(myJobsQuery, (snapshot) => {
                myPostedJobsList = [];
                snapshot.forEach(doc => {
                    myPostedJobsList.push({ id: doc.id, ...doc.data() });
                });
                myPostedJobsList.sort((a, b) => b.timestamp - a.timestamp);
                if (currentView === 'profile') renderRegistrationProfile();
            });

            // 3. Listen for pending users (Admin only)
            if (isUserAdmin) {
                const pendingColRef = collection(db, `artifacts/${app.options.projectId}/public/data/pending_profiles`);
                onSnapshot(pendingColRef, (snapshot) => {
                    pendingUsersList = [];
                    snapshot.forEach(doc => {
                        pendingUsersList.push({ uid: doc.id, ...doc.data() });
                    });
                    if (currentView === 'profile') renderAdminPanel();
                });

                // Fetch approved users
                const approvedUsersQuery = query(
                    collection(db, `artifacts/${app.options.projectId}/users`),
                    where("profile.data.status", "==", "approved")
                );
                
                const allUsersRef = collection(db, `artifacts/${app.options.projectId}/users`);
                const allUsersSnap = await getDocs(allUsersRef);
                
                approvedUsersList = [];
                for (const userDoc of allUsersSnap.docs) {
                    const userProfileRef = doc(db, `artifacts/${app.options.projectId}/users/${userDoc.id}/profile/data`);
                    const profileSnap = await getDoc(userProfileRef);
                    
                    if (profileSnap.exists() && profileSnap.data().status === 'approved') {
                        approvedUsersList.push({
                            uid: userDoc.id,
                            ...profileSnap.data()
                        });
                    }
                }
                
                approvedUsersList.sort((a, b) => {
                    const nameA = a.passportName || a.email || '';
                    const nameB = b.passportName || b.email || '';
                    return nameA.localeCompare(nameB);
                });

                // Load admin report links
                const reportLinksRef = doc(db, `artifacts/${app.options.projectId}/admin/report_links`);
                const reportLinksSnap = await getDoc(reportLinksRef);
                if (reportLinksSnap.exists()) {
                    adminReportLinks = reportLinksSnap.data();
                }
            }

            // 4. Listen for public jobs
            const publicJobsCollectionRef = collection(db, `artifacts/${app.options.projectId}/public/data/jobs`);
            const q = query(publicJobsCollectionRef, orderBy("timestamp", "desc"));

            onSnapshot(q, (snapshot) => {
                let jobsList = [];
                snapshot.forEach(doc => {
                    jobsList.push({ id: doc.id, ...doc.data() });
                });
                window.jobsList = jobsList;
                if (currentView === 'home') renderHome();
            });

            // 5. Listen for notifications
            const notificationsColRef = collection(db, `artifacts/${app.options.projectId}/public/data/notifications`);
            onSnapshot(notificationsColRef, (snapshot) => {
                window.notificationsList = [];
                snapshot.forEach(doc => {
                    window.notificationsList.push({ id: doc.id, ...doc.data() });
                });
                window.notificationsList.sort((a, b) => b.timestamp - a.timestamp);
                updateNotificationBadge();
                if (currentView === 'notifications') renderNotifications();
            });

            // 6. Listen for public contact data
            const publicContactsColRef = collection(db, `artifacts/${app.options.projectId}/public/data/public_contacts`);
            onSnapshot(publicContactsColRef, (snapshot) => {
                window.publicContactsCache = {};
                snapshot.forEach(doc => {
                    window.publicContactsCache[doc.id] = doc.data();
                });
            });

            // 7. Listen for car rental data
            const carRentalColRef = collection(db, `artifacts/${app.options.projectId}/public/data/car_rental`);
            onSnapshot(carRentalColRef, (snapshot) => {
                carRentalList = [];
                snapshot.forEach(doc => {
                    carRentalList.push({ id: doc.id, ...doc.data() });
                });
                if (currentView === 'carRental') renderCarRental();
            });
        }

        // Update UI based on profile
        function updateUIBasedOnProfile() {
            const isApproved = currentUserProfile && currentUserProfile.status === 'approved';
            
            updateActiveNav();
            updateNotificationBadge();

            if (isApproved && !isUserAdmin) {
                postJobNavBtn.classList.remove('hidden');
            } else {
                postJobNavBtn.classList.add('hidden');
            }
        }

        // Set Current View
        window.setView = function(view) {
            currentView = view;
            updateUIBasedOnProfile();
            renderCurrentView();
        }

        // Render Current View
        function renderCurrentView() {
            if (!isAuthReady) {
                showLoading();
                return;
            }
            
            if (!currentUserId) {
                renderLoginSignup();
                return;
            }
            
            hideLoading();
            
            try {
                if (isUserAdmin && currentView === 'profile') {
                    return renderAdminPanel();
                }

                if (currentView === 'post' && (!currentUserProfile || currentUserProfile.status !== 'approved')) {
                     currentView = 'profile';
                }

                switch (currentView) {
                    case 'home':
                        renderHome();
                        break;
                    case 'profile':
                        renderRegistrationProfile();
                        break;
                    case 'post':
                        renderJobPostForm();
                        break;
                    case 'notifications':
                        renderNotifications();
                        break;
                    case 'carRental':
                        renderCarRental();
                        break;
                    default:
                        renderHome();
                }
            } catch (error) {
                 logStatus(`Error during View Render: ${error.message}`, true);
                 contentDiv.innerHTML = `
                    <div class="text-center p-8">
                        <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                        <h3 class="text-lg font-bold text-red-400 mb-2">·Äô·Äº·ÄÑ·Ä∫·ÄÄ·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Äº·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Ä°·Äô·Äæ·Ä¨·Ä∏·Äñ·Äº·ÄÖ·Ä∫·Äï·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫</h3>
                        <p class="text-gray-400">${error.message}</p>
                    </div>
                 `;
            }
        }

        // View: Login/Signup
        function renderLoginSignup() {
            contentDiv.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-[70vh]">
                    <div class="glass-card p-8 rounded-2xl w-full max-w-md shadow-neumorphism">
                        <div class="text-center mb-8">
                            <div class="gradient-bg w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-briefcase text-white text-3xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-white">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äõ·Äæ·Ä¨·Äñ·ÄΩ·Ä±·Äõ·Ä±·Ä∏</h2>
                            <p class="text-gray-400 mt-2">Thai Myanmar Job Portal</p>
                        </div>
                        
                        <form id="auth-form" class="space-y-5">
                            <div id="signup-name-field" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-2">·Ä°·Äô·Ää·Ä∫</label>
                                <input type="text" id="name" class="input-field w-full p-3" placeholder="·Äû·ÄÑ·Ä∑·Ä∫·Ä°·Äô·Ää·Ä∫·ÄÄ·Ä≠·ÄØ ·Äõ·Ä±·Ä∏·Äï·Ä´">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫</label>
                                <input type="email" id="email" required class="input-field w-full p-3" placeholder="example@gmail.com">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫</label>
                                <input type="password" id="password" required class="input-field w-full p-3" placeholder="·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫ ·ÅÜ ·Äú·ÄØ·Ä∂·Ä∏·Ä°·Äë·ÄÄ·Ä∫">
                            </div>
                            
                            <button type="button" onclick="handleAuth(event, false)" class="btn-primary w-full p-3">
                                <i class="fas fa-sign-in-alt mr-2"></i>·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äõ·Äî·Ä∫
                            </button>
                            
                            <div class="text-center my-4">
                                <span class="text-gray-400">·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫</span>
                            </div>
                            
                            <button type="button" onclick="handleAuth(event, true)" class="gradient-bg-green w-full p-3 rounded-lg text-white font-semibold">
                                <i class="fas fa-user-plus mr-2"></i>·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äõ·Äî·Ä∫
                            </button>
                            
                            <div class="text-center mt-6">
                                <button type="button" onclick="toggleAuthMode()" id="toggle-auth-btn" class="text-blue-400 hover:text-blue-300 text-sm">
                                    ·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-8 pt-6 border-t border-gray-700">
                            <p class="text-center text-gray-400 text-sm">
                                <i class="fas fa-info-circle mr-1"></i>
                                Admin ·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äú·Ä≠·ÄØ·Äï·Ä´·ÄÄ thaimyanmarjob52@gmail.com
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Toggle between Login and Signup
        window.toggleAuthMode = function() {
            const nameField = document.getElementById('signup-name-field');
            const toggleBtn = document.getElementById('toggle-auth-btn');
            const loginBtn = document.querySelector('button[onclick="handleAuth(event, false)"]');
            
            if (nameField.classList.contains('hidden')) {
                nameField.classList.remove('hidden');
                toggleBtn.textContent = '·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äõ·Äæ·Ä≠·Äï·Äº·ÄÆ·Ä∏·Äû·Ä¨·Ä∏·Äú·Ä¨·Ä∏? ·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´';
                loginBtn.classList.add('hidden');
            } else {
                nameField.classList.add('hidden');
                toggleBtn.textContent = '·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äõ·Äî·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Ä´';
                loginBtn.classList.remove('hidden');
            }
        }

        // View: Home/Job Feed
        function renderHome() {
            const jobsList = window.jobsList || [];
            
            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏</h2>
                    <p class="text-gray-400">·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äê·ÄΩ·ÄÑ·Ä∫ ${jobsList.length} ·ÄÅ·ÄØ·Äõ·Äæ·Ä≠·Äï·Ä´·Äû·Ää·Ä∫</p>
                </div>
            `;
            
            if (jobsList.length === 0) {
                contentDiv.innerHTML += `
                    <div class="glass-card p-8 text-center rounded-2xl">
                        <i class="fas fa-briefcase text-4xl text-gray-500 mb-4"></i>
                        <h3 class="text-lg font-bold text-gray-400 mb-2">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Ä≠·ÄØ·ÄÑ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</h3>
                        <p class="text-gray-500">·Äï·Äë·Äô·ÄÜ·ÄØ·Ä∂·Ä∏·Ä°·Äú·ÄØ·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Ä°·Äû·ÄÑ·Ä∑·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Äî·Ä±·Äï·Ä´·Äï·Äº·ÄÆ</p>
                    </div>
                `;
                return;
            }

            jobsList.forEach(job => {
                const images = job.media?.images || [];
                const date = job.timestamp ? new Date(job.timestamp).toLocaleDateString('my-MM', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) : '·Äô·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·Äë·Ä¨·Ä∏';
                
                const imagePreviews = images.map((url, i) => `
                    <div class="relative">
                        <img src="${url}" onerror="this.onerror=null;this.src='https://placehold.co/100x64/374151/94a3b8?text=Image${i+1}'" 
                             alt="Job Image" 
                             class="w-full h-16 object-cover rounded-lg cursor-pointer hover:opacity-80 transition"
                             onclick="showImageZoomModal('${url}')">
                        <div class="absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">
                            <button onclick="event.stopPropagation(); saveImage('${url}', '${job.title}_${i+1}')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                `).join('') || '';

                const jobCard = `
                    <div class="job-card glass-card p-5 mb-4 rounded-xl">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="text-lg font-bold text-white mb-1">${job.title || '·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·Äô·Ää·Ä∫·Äô·Äõ·Äæ·Ä≠'}</h3>
                                <p class="text-sm text-gray-400">
                                    <i class="fas fa-user mr-1"></i>${job.postedByName} | 
                                    <i class="fas fa-calendar ml-2 mr-1"></i>${date}
                                </p>
                            </div>
                            ${currentUserId === job.postedBy ? `
                                <button onclick="deleteJob('${job.id}')" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">üìç ·Äê·Ää·Ä∫·Äî·Ä±·Äõ·Ä¨</p>
                                <p class="text-sm font-medium">${job.location}</p>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">üíµ ·Äú·ÄÖ·Ä¨</p>
                                <p class="text-sm font-medium">${job.salaryMin} - ${job.salaryMax} ·Äò·Äê·Ä∫</p>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">üí∏ ·ÄÖ·Äô·Äê·Ä∫·ÄÅ</p>
                                <p class="text-sm font-medium">${job.smartFee || 0} ·Äò·Äê·Ä∫</p>
                            </div>
                            <div class="bg-gray-800 p-3 rounded-lg">
                                <p class="text-xs text-gray-400 mb-1">üìÖ ·Äõ·ÄÄ·Ä∫·ÄÖ·ÄΩ·Ä≤</p>
                                <p class="text-sm font-medium">${date}</p>
                            </div>
                        </div>
                        
                        ${job.description ? `
                            <div class="mb-3">
                                <p class="text-gray-300 whitespace-pre-wrap">${job.description.substring(0, 150)}${job.description.length > 150 ? '...' : ''}</p>
                            </div>
                        ` : ''}
                        
                        ${imagePreviews ? `
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                ${imagePreviews}
                            </div>
                        ` : ''}
                        
                        <button onclick="showJobPosterContacts('${job.postedBy}', '${job.postedByName}')" class="btn-primary w-full p-3">
                            <i class="fas fa-phone-alt mr-2"></i>·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫
                        </button>
                    </div>
                `;
                contentDiv.innerHTML += jobCard;
            });
        }

        // Delete Job Function
        window.deleteJob = async function(jobId) {
            if (!confirm('·Ä§·Ä°·Äú·ÄØ·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äô·Äæ·Ä¨ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?')) return;
            
            try {
                await deleteDoc(doc(db, `artifacts/${app.options.projectId}/public/data/jobs`, jobId));
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Ä°·Äú·ÄØ·Äï·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Delete Job Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Ä°·Äú·ÄØ·Äï·Ä∫·Äñ·Äª·ÄÄ·Ä∫·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        }

        // Save Image Function
        window.saveImage = async function(imageUrl, filename) {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename || 'job_image.jpg';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Äï·ÄØ·Ä∂·ÄÄ·Ä≠·ÄØ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Image Save Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äï·ÄØ·Ä∂·Äû·Ä≠·Äô·Ä∫·Ä∏·Åç·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // Image Zoom Modal
        window.showImageZoomModal = function(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-white">·Äï·ÄØ·Ä∂·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫</h3>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <img src="${imageUrl}" class="w-full h-auto rounded-lg mb-4" alt="Zoomed Image">
                    <div class="flex space-x-2">
                        <button onclick="saveImage('${imageUrl}', 'job_image')" class="btn-primary flex-1 p-2">
                            <i class="fas fa-download mr-2"></i>·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫
                        </button>
                        <button onclick="this.closest('.modal-overlay').remove()" class="btn-danger flex-1 p-2">
                            <i class="fas fa-times mr-2"></i>·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        // Show Job Poster Contacts
        window.showJobPosterContacts = function(posterId, posterName) {
            const contact = window.publicContactsCache[posterId];

            if (!contact) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´', 'error');
            }

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content p-5">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white">${posterName}</h3>
                            <p class="text-gray-400 text-sm">·Åè ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏</p>
                        </div>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-phone text-blue-400 mr-3"></i>
                                <p class="text-sm text-gray-400">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</p>
                            </div>
                            <p class="text-lg font-bold text-white">${contact.thaiPhoneNumber || '·Äô·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äë·Ä¨·Ä∏·Äï·Ä´'}</p>
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-facebook-messenger text-blue-500 mr-3"></i>
                                <p class="text-sm text-gray-400">Messenger</p>
                            </div>
                            ${contact.messengerLink ? `
                                <a href="${contact.messengerLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                    ${contact.messengerLink}
                                </a>
                            ` : '<p class="text-gray-400">·Äô·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äë·Ä¨·Ä∏·Äï·Ä´</p>'}
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-facebook text-blue-600 mr-3"></i>
                                <p class="text-sm text-gray-400">Facebook</p>
                            </div>
                            ${contact.facebookLink ? `
                                <a href="${contact.facebookLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                    ${contact.facebookLink}
                                </a>
                            ` : '<p class="text-gray-400">·Äô·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äë·Ä¨·Ä∏·Äï·Ä´</p>'}
                        </div>
                        
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-telegram text-blue-400 mr-3"></i>
                                <p class="text-sm text-gray-400">Telegram</p>
                            </div>
                            ${contact.telegramLink ? `
                                <a href="${contact.telegramLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                    ${contact.telegramLink}
                                </a>
                            ` : '<p class="text-gray-400">·Äô·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äë·Ä¨·Ä∏·Äï·Ä´</p>'}
                        </div>
                    </div>
                    
                    <button onclick="this.closest('.modal-overlay').remove()" class="btn-primary w-full mt-6 p-3">
                        <i class="fas fa-times mr-2"></i>·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        };

        // View: Profile/Registration
        function renderRegistrationProfile() {
            const user = currentUserProfile;
            let statusBadge, formContent;

            if (!user || !user.status || user.status === 'denied') {
                statusBadge = '<span class="status-badge status-denied">·Äô·Äæ·Äê·Ä∫·Äï·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äû·Ää·Ä∫</span>';
                formContent = renderProfileSubmissionForm();
            } else if (user.status === 'pending') {
                statusBadge = '<span class="status-badge status-pending">Admin ·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫</span>';
                formContent = `
                    <div class="glass-card p-6 text-center rounded-xl">
                        <i class="fas fa-clock text-4xl text-yellow-500 mb-4"></i>
                        <h3 class="text-lg font-bold text-white mb-2">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫</h3>
                        <p class="text-gray-400">·Äû·ÄÑ·Ä∫·Åè ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Admin ·Äô·Äæ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫·Åã</p>
                        <p class="text-gray-500 text-sm mt-2">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·ÄÄ ·Ä°·Äú·ÄØ·Äï·Ä∫·Äê·ÄÑ·Ä∫·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫ ·Äõ·Äï·Ä´·Äô·Ää·Ä∫·Åã</p>
                    </div>
                `;
            } else {
                statusBadge = '<span class="status-badge status-approved">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏</span>';
                formContent = renderApprovedProfile(user);
            }

            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">·Äï·Äõ·Ä≠·ÄØ·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫</h2>
                    <p class="text-gray-400">·Äû·ÄÑ·Ä∑·Ä∫·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä±</p>
                </div>
                
                <div class="glass-card p-6 rounded-2xl mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-lg font-bold text-white">·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä±</h3>
                            <p class="text-gray-400 text-sm">${currentUserEmail}</p>
                        </div>
                        ${statusBadge}
                    </div>
                    ${formContent}
                </div>
                
                <div class="glass-card p-6 rounded-2xl">
                    <h3 class="text-lg font-bold text-white mb-4">·Ä°·ÄÅ·Äº·Ä¨·Ä∏·Äú·ÄØ·Äï·Ä∫·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏</h3>
                    <button onclick="handleLogout()" class="btn-danger w-full p-3">
                        <i class="fas fa-sign-out-alt mr-2"></i>·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äô·Äæ ·Äë·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫
                    </button>
                </div>
            `;
        }

        // Profile Submission Form
        function renderProfileSubmissionForm() {
            return `
                <form id="profile-form" class="space-y-5" onsubmit="submitProfile(event)">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">·Äî·Ä¨·Äô·Ää·Ä∫ (·Äï·Äê·Ä∫·ÄÖ·Äï·Ä≠·ÄØ·Ä∑)</label>
                        <input type="text" id="passport-name" required class="input-field w-full p-3" value="${currentUserProfile?.passportName || ''}">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</label>
                        <input type="tel" id="phone-number" required class="input-field w-full p-3" value="${currentUserProfile?.thaiPhoneNumber || ''}" placeholder="0926458647">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Messenger Link</label>
                            <input type="url" id="messenger-link" class="input-field w-full p-3" value="${currentUserProfile?.messengerLink || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Facebook Link</label>
                            <input type="url" id="facebook-link" class="input-field w-full p-3" value="${currentUserProfile?.facebookLink || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Telegram Link</label>
                            <input type="url" id="telegram-link" class="input-field w-full p-3" value="${currentUserProfile?.telegramLink || ''}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Äî·Ä±·Äõ·Äï·Ä∫·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨</label>
                            <textarea id="address" rows="2" required class="input-field w-full p-3">${currentUserProfile?.address || ''}</textarea>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Äï·Äê·Ä∫·ÄÖ·Äï·Ä≠·ÄØ·Ä∑·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</label>
                            <input type="file" id="passport-file" accept="image/*" required onchange="handleProfileFileChange(event, 'passport')" class="input-field w-full p-2">
                            <p id="passport-file-status" class="text-xs text-blue-400 mt-1"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Äú·Ä∞·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</label>
                            <input type="file" id="user-photo-file" accept="image/*" required onchange="handleProfileFileChange(event, 'user_photo')" class="input-field w-full p-2">
                            <p id="user-photo-file-status" class="text-xs text-blue-400 mt-1"></p>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-success w-full p-3">
                        <i class="fas fa-paper-plane mr-2"></i>Admin ·Äë·Ä∂ ·Äï·Ä≠·ÄØ·Ä∑·Äõ·Äî·Ä∫
                    </button>
                </form>
            `;
        }

        // Approved Profile View
        function renderApprovedProfile(user) {
            return `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-bold text-white mb-4">·ÄÄ·Ä≠·ÄØ·Äö·Ä∫·Äõ·Ä±·Ä∏·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫</p>
                                <p class="text-white">${currentUserEmail}</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äî·Ä¨·Äô·Ää·Ä∫</p>
                                <p class="text-white">${user.passportName}</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</p>
                                <p class="text-white">${user.thaiPhoneNumber}</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨</p>
                                <p class="text-white">${user.address}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <p class="text-sm text-gray-400 mb-2">·Äï·Äê·Ä∫·ÄÖ·Äï·Ä≠·ÄØ·Ä∑·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</p>
                            ${user.passportPhotoUrl ? `
                                <img src="${user.passportPhotoUrl}" class="w-full h-32 object-cover rounded-lg cursor-pointer" onclick="showImageZoomModal('${user.passportPhotoUrl}')">
                            ` : '<div class="h-32 bg-gray-800 rounded-lg flex items-center justify-center"><i class="fas fa-image text-gray-500"></i></div>'}
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-gray-400 mb-2">·Äú·Ä∞·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</p>
                            ${user.userPhotoUrl ? `
                                <img src="${user.userPhotoUrl}" class="w-full h-32 object-cover rounded-lg cursor-pointer" onclick="showImageZoomModal('${user.userPhotoUrl}')">
                            ` : '<div class="h-32 bg-gray-800 rounded-lg flex items-center justify-center"><i class="fas fa-user text-gray-500"></i></div>'}
                        </div>
                    </div>
                    
                    ${renderContactEditForm(user)}
                    ${renderMyPostedJobs()}
                </div>
            `;
        }

        // Contact Edit Form
        function renderContactEditForm(user) {
            return `
                <div class="pt-6 border-t border-gray-700">
                    <h3 class="text-lg font-bold text-white mb-4">·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫ ·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äõ·Äî·Ä∫</h3>
                    <form id="contact-edit-form" class="space-y-4" onsubmit="updateContactInfo(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</label>
                                <input type="tel" id="edit-phone-number" required class="input-field w-full p-3" value="${user.thaiPhoneNumber || ''}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Messenger Link</label>
                                <input type="url" id="edit-messenger-link" class="input-field w-full p-3" value="${user.messengerLink || ''}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Facebook Link</label>
                                <input type="url" id="edit-facebook-link" class="input-field w-full p-3" value="${user.facebookLink || ''}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Telegram Link</label>
                                <input type="url" id="edit-telegram-link" class="input-field w-full p-3" value="${user.telegramLink || ''}">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary w-full p-3">
                            <i class="fas fa-save mr-2"></i>·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äô·Äæ·ÄØ·Äô·Äª·Ä¨·Ä∏ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫
                        </button>
                    </form>
                </div>
            `;
        }

        // My Posted Jobs
        function renderMyPostedJobs() {
            if (myPostedJobsList.length === 0) return '';
            
            return `
                <div class="pt-6 border-t border-gray-700">
                    <h3 class="text-lg font-bold text-white mb-4">·Äû·ÄÑ·Ä∑·Ä∫·Äô·Äæ ·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ ·Ä°·Äú·ÄØ·Äï·Ä∫·Äô·Äª·Ä¨·Ä∏ (${myPostedJobsList.length})</h3>
                    <div class="space-y-3">
                        ${myPostedJobsList.map(job => `
                            <div class="bg-gray-800 p-3 rounded-lg flex justify-between items-center">
                                <div>
                                    <h4 class="font-bold text-white">${job.title}</h4>
                                    <p class="text-sm text-gray-400">${job.location} | ${job.salaryMin}-${job.salaryMax} ·Äò·Äê·Ä∫</p>
                                </div>
                                <button onclick="deleteJob('${job.id}')" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Handle Profile File Change
        window.handleProfileFileChange = function(event, type) {
            const file = event.target.files[0];
            const statusElement = document.getElementById(`${type}-file-status`);
            
            if (file) {
                if (type === 'passport') selectedPassportFile = file;
                else selectedUserPhotoFile = file;
                
                statusElement.textContent = `·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Äº·ÄÆ·Ä∏: ${file.name}`;
            } else {
                if (type === 'passport') selectedPassportFile = null;
                else selectedUserPhotoFile = null;
                
                statusElement.textContent = '';
            }
        }

        // Submit Profile
        window.submitProfile = async function(event) {
            event.preventDefault();
            
            const passportName = document.getElementById('passport-name').value;
            const phoneNumber = document.getElementById('phone-number').value;
            const messengerLink = document.getElementById('messenger-link').value;
            const facebookLink = document.getElementById('facebook-link').value;
            const telegramLink = document.getElementById('telegram-link').value;
            const address = document.getElementById('address').value;

            if (!selectedPassportFile || !selectedUserPhotoFile) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äô·Äª·Ä¨·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'error');
            }

            try {
                showLoading();
                
                const [passportUrl, userPhotoUrl] = await Promise.all([
                    uploadToCloudinary(selectedPassportFile),
                    uploadToCloudinary(selectedUserPhotoFile)
                ]);
                
                const profileData = {
                    passportName,
                    thaiPhoneNumber: phoneNumber,
                    messengerLink,
                    facebookLink,
                    telegramLink,
                    address,
                    passportPhotoUrl: passportUrl,
                    userPhotoUrl: userPhotoUrl,
                    status: 'pending',
                    timestamp: Date.now(),
                    email: currentUserEmail
                };

                const userDocRef = doc(db, `artifacts/${app.options.projectId}/users/${currentUserId}/profile/data`);
                await setDoc(userDocRef, profileData);
                
                const pendingDocRef = doc(db, `artifacts/${app.options.projectId}/public/data/pending_profiles`, currentUserId);
                await setDoc(pendingDocRef, profileData);

                selectedPassportFile = null;
                selectedUserPhotoFile = null;

                hideLoading();
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', 'Admin ·Äë·Ä∂ ·Äï·Ä≠·ÄØ·Ä∑·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                hideLoading();
                logStatus(`Profile Submission Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', `·Äê·ÄÑ·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Åç ·Äô·Äõ·Äï·Ä´: ${error.message}`, 'error');
            }
        }

        // Update Contact Info
        window.updateContactInfo = async function(event) {
            event.preventDefault();
            
            const phoneNumber = document.getElementById('edit-phone-number').value;
            const messengerLink = document.getElementById('edit-messenger-link').value;
            const facebookLink = document.getElementById('edit-facebook-link').value;
            const telegramLink = document.getElementById('edit-telegram-link').value;

            try {
                showLoading();
                
                const updateData = {
                    thaiPhoneNumber: phoneNumber,
                    messengerLink,
                    facebookLink,
                    telegramLink,
                    lastUpdated: Date.now()
                };

                const userDocRef = doc(db, `artifacts/${app.options.projectId}/users/${currentUserId}/profile/data`);
                await updateDoc(userDocRef, updateData);
                
                const publicContactRef = doc(db, `artifacts/${app.options.projectId}/public/data/public_contacts`, currentUserId);
                await setDoc(publicContactRef, updateData, { merge: true });

                hideLoading();
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                hideLoading();
                logStatus(`Contact Update Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', `·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Åç ·Äô·Äõ·Äï·Ä´: ${error.message}`, 'error');
            }
        }

        // View: Admin Panel
        function renderAdminPanel() {
            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Admin Panel</h2>
                    <div class="flex items-center text-gray-400">
                        <i class="fas fa-user-shield mr-2"></i>
                        <span>${ADMIN_EMAIL}</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="gradient-bg-green p-4 rounded-xl">
                        <h3 class="font-bold text-white mb-2">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ User</h3>
                        <p class="text-3xl font-bold text-white">${approvedUsersList.length}</p>
                    </div>
                    <div class="gradient-bg-yellow p-4 rounded-xl">
                        <h3 class="font-bold text-white mb-2">·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ä±·Ä¨ User</h3>
                        <p class="text-3xl font-bold text-white">${pendingUsersList.length}</p>
                    </div>
                </div>
                
                <!-- Send Notification -->
                <div class="glass-card p-5 rounded-xl mb-6">
                    <h3 class="text-lg font-bold text-white mb-4">·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫ ·Äï·Ä≠·ÄØ·Ä∑·Äõ·Äî·Ä∫</h3>
                    <form id="send-notification-form" class="space-y-4" onsubmit="sendNotification(event)">
                        <input type="text" id="notification-title" required class="input-field w-full p-3" placeholder="·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫">
                        <textarea id="notification-content" rows="3" required class="input-field w-full p-3" placeholder="·ÄÖ·Ä¨·Äû·Ä¨·Ä∏"></textarea>
                        <button type="submit" class="btn-primary w-full p-3">
                            <i class="fas fa-paper-plane mr-2"></i>·Äï·Ä≠·ÄØ·Ä∑·Äõ·Äî·Ä∫
                        </button>
                    </form>
                </div>
                
                <!-- Report Links Management -->
                <div class="glass-card p-5 rounded-xl mb-6">
                    <h3 class="text-lg font-bold text-white mb-4">·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·Äº·Ä¨·Ä∏·Äõ·Äî·Ä∫ ·Äú·ÄÑ·Ä∑·Ä∫·Äô·Äª·Ä¨·Ä∏</h3>
                    <form id="report-links-form" class="space-y-4" onsubmit="updateReportLinks(event)">
                        <input type="email" id="report-email" class="input-field w-full p-3" placeholder="Email" value="${adminReportLinks.email || ''}">
                        <input type="tel" id="report-phone" class="input-field w-full p-3" placeholder="Phone" value="${adminReportLinks.phone || ''}">
                        <input type="url" id="report-messenger" class="input-field w-full p-3" placeholder="Messenger Link" value="${adminReportLinks.messenger || ''}">
                        <input type="url" id="report-telegram" class="input-field w-full p-3" placeholder="Telegram Link" value="${adminReportLinks.telegram || ''}">
                        <button type="submit" class="btn-success w-full p-3">
                            <i class="fas fa-save mr-2"></i>·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫
                        </button>
                    </form>
                </div>
                
                <!-- Car Rental Management -->
                <div class="glass-card p-5 rounded-xl mb-6">
                    <h3 class="text-lg font-bold text-white mb-4">·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äõ·Äî·Ä∫ ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫</h3>
                    <form id="car-rental-form" class="space-y-4" onsubmit="addCarRental(event)">
                        <input type="text" id="car-name" required class="input-field w-full p-3" placeholder="·Ä°·Äô·Ää·Ä∫">
                        <input type="tel" id="car-phone" required class="input-field w-full p-3" placeholder="·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫">
                        <input type="url" id="car-messenger" class="input-field w-full p-3" placeholder="Messenger Link">
                        <input type="url" id="car-telegram" class="input-field w-full p-3" placeholder="Telegram Link">
                        <button type="submit" class="gradient-bg-purple text-white w-full p-3 rounded-lg font-semibold">
                            <i class="fas fa-plus mr-2"></i>·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫
                        </button>
                    </form>
                </div>
                
                <!-- Approved Users List -->
                <div class="glass-card p-5 rounded-xl mb-6">
                    <h3 class="text-lg font-bold text-white mb-4">·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äë·Ä¨·Ä∏·Äû·Ä±·Ä¨ User ·Äô·Äª·Ä¨·Ä∏</h3>
                    <div id="approved-users-list" class="space-y-3"></div>
                </div>
                
                <!-- Pending Users List -->
                <div class="glass-card p-5 rounded-xl">
                    <h3 class="text-lg font-bold text-white mb-4">·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ä±·Ä¨ User ·Äô·Äª·Ä¨·Ä∏ (${pendingUsersList.length})</h3>
                    <div id="pending-users-list"></div>
                </div>
            `;

            // Render approved users
            const approvedListDiv = document.getElementById('approved-users-list');
            if (approvedListDiv) {
                approvedUsersList.forEach(user => {
                    approvedListDiv.innerHTML += `
                        <div class="bg-gray-800 p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-700 transition" onclick="showUserDetails('${user.uid}')">
                            <div>
                                <h4 class="font-bold text-white">${user.passportName || user.email}</h4>
                                <p class="text-sm text-gray-400">${user.email}</p>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    `;
                });
            }

            // Render pending users
            const pendingListDiv = document.getElementById('pending-users-list');
            if (pendingListDiv) {
                pendingUsersList.forEach(user => {
                    pendingListDiv.innerHTML += `
                        <div class="bg-yellow-900 bg-opacity-20 p-4 rounded-lg mb-3 border border-yellow-800">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold text-white">${user.passportName || '·Ä°·Äô·Ää·Ä∫·Äô·Äõ·Äæ·Ä≠'}</h4>
                                    <p class="text-sm text-gray-400">${user.email}</p>
                                    <p class="text-sm text-gray-400">${user.thaiPhoneNumber}</p>
                                </div>
                                <button onclick="approveUser('${user.uid}')" class="btn-success px-4 py-2">
                                    <i class="fas fa-check mr-1"></i>·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äõ·Äî·Ä∫
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                ${user.passportPhotoUrl ? `
                                    <div class="relative">
                                        <img src="${user.passportPhotoUrl}" class="w-full h-24 object-cover rounded-lg" onclick="showImageZoomModal('${user.passportPhotoUrl}')">
                                        <button onclick="event.stopPropagation(); saveImage('${user.passportPhotoUrl}', 'passport_${user.uid}')" class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white p-1 rounded">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                ` : ''}
                                ${user.userPhotoUrl ? `
                                    <div class="relative">
                                        <img src="${user.userPhotoUrl}" class="w-full h-24 object-cover rounded-lg" onclick="showImageZoomModal('${user.userPhotoUrl}')">
                                        <button onclick="event.stopPropagation(); saveImage('${user.userPhotoUrl}', 'user_${user.uid}')" class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white p-1 rounded">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
            }
        }

        // Update Report Links
        window.updateReportLinks = async function(event) {
            event.preventDefault();
            
            const reportData = {
                email: document.getElementById('report-email').value,
                phone: document.getElementById('report-phone').value,
                messenger: document.getElementById('report-messenger').value,
                telegram: document.getElementById('report-telegram').value,
                updatedAt: Date.now()
            };

            try {
                const reportLinksRef = doc(db, `artifacts/${app.options.projectId}/admin/report_links`);
                await setDoc(reportLinksRef, reportData, { merge: true });
                adminReportLinks = reportData;
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·Äº·Ä¨·Ä∏·Äõ·Äî·Ä∫ ·Äú·ÄÑ·Ä∑·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Update Report Links Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        }

        // Show Report Modal
        window.showReportModal = function() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-white">·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·ÄÄ·Äº·Ä¨·Ä∏·Äõ·Äî·Ä∫</h3>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        ${adminReportLinks.email ? `
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-envelope text-blue-400 mr-3"></i>
                                    <p class="text-sm text-gray-400">Email</p>
                                </div>
                                <a href="mailto:${adminReportLinks.email}" class="text-blue-400 hover:text-blue-300">
                                    ${adminReportLinks.email}
                                </a>
                            </div>
                        ` : ''}
                        
                        ${adminReportLinks.phone ? `
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-phone text-green-400 mr-3"></i>
                                    <p class="text-sm text-gray-400">Phone</p>
                                </div>
                                <a href="tel:${adminReportLinks.phone}" class="text-green-400 hover:text-green-300">
                                    ${adminReportLinks.phone}
                                </a>
                            </div>
                        ` : ''}
                        
                        ${adminReportLinks.messenger ? `
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <i class="fab fa-facebook-messenger text-blue-500 mr-3"></i>
                                    <p class="text-sm text-gray-400">Messenger</p>
                                </div>
                                <a href="${adminReportLinks.messenger}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                    ${adminReportLinks.messenger}
                                </a>
                            </div>
                        ` : ''}
                        
                        ${adminReportLinks.telegram ? `
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <i class="fab fa-telegram text-blue-400 mr-3"></i>
                                    <p class="text-sm text-gray-400">Telegram</p>
                                </div>
                                <a href="${adminReportLinks.telegram}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                    ${adminReportLinks.telegram}
                                </a>
                            </div>
                        ` : ''}
                    </div>
                    
                    <button onclick="this.closest('.modal-overlay').remove()" class="btn-primary w-full mt-6 p-3">
                        <i class="fas fa-times mr-2"></i>·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show User Details
        window.showUserDetails = async function(userId) {
            try {
                const userDocRef = doc(db, `artifacts/${app.options.projectId}/users/${userId}/profile/data`);
                const userSnap = await getDoc(userDocRef);
                
                if (!userSnap.exists()) {
                    return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', 'User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´', 'error');
                }
                
                const user = userSnap.data();
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                
                modal.innerHTML = `
                    <div class="modal-content p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-white">User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫</h3>
                            <button onclick="this.closest('.modal-overlay').remove()" class="text-gray-400 hover:text-white">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                ${user.passportPhotoUrl ? `
                                    <div class="text-center">
                                        <p class="text-sm text-gray-400 mb-2">·Äï·Äê·Ä∫·ÄÖ·Äï·Ä≠·ÄØ·Ä∑·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</p>
                                        <img src="${user.passportPhotoUrl}" class="w-full h-32 object-cover rounded-lg cursor-pointer" onclick="showImageZoomModal('${user.passportPhotoUrl}')">
                                    </div>
                                ` : ''}
                                ${user.userPhotoUrl ? `
                                    <div class="text-center">
                                        <p class="text-sm text-gray-400 mb-2">·Äú·Ä∞·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂</p>
                                        <img src="${user.userPhotoUrl}" class="w-full h-32 object-cover rounded-lg cursor-pointer" onclick="showImageZoomModal('${user.userPhotoUrl}')">
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Ä°·ÄÆ·Ä∏·Äô·Ä±·Ä∏·Äú·Ä∫</p>
                                <p class="text-white">${user.email}</p>
                            </div>
                            
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äî·Ä¨·Äô·Ää·Ä∫</p>
                                <p class="text-white">${user.passportName}</p>
                            </div>
                            
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫</p>
                                <p class="text-white">${user.thaiPhoneNumber}</p>
                            </div>
                            
                            ${user.messengerLink ? `
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <p class="text-sm text-gray-400 mb-1">Messenger</p>
                                    <a href="${user.messengerLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                        ${user.messengerLink}
                                    </a>
                                </div>
                            ` : ''}
                            
                            ${user.facebookLink ? `
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <p class="text-sm text-gray-400 mb-1">Facebook</p>
                                    <a href="${user.facebookLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                        ${user.facebookLink}
                                    </a>
                                </div>
                            ` : ''}
                            
                            ${user.telegramLink ? `
                                <div class="bg-gray-800 p-4 rounded-lg">
                                    <p class="text-sm text-gray-400 mb-1">Telegram</p>
                                    <a href="${user.telegramLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all">
                                        ${user.telegramLink}
                                    </a>
                                </div>
                            ` : ''}
                            
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-sm text-gray-400 mb-1">·Äú·Ä≠·Äï·Ä∫·ÄÖ·Ä¨</p>
                                <p class="text-white">${user.address}</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2 mt-6">
                            <button onclick="saveUserInfo('${userId}')" class="btn-primary flex-1 p-3">
                                <i class="fas fa-download mr-2"></i>·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫
                            </button>
                            <button onclick="this.closest('.modal-overlay').remove()" class="btn-danger flex-1 p-3">
                                <i class="fas fa-times mr-2"></i>·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            } catch (error) {
                logStatus(`Show User Details Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', 'User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Åç·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // Save User Info
        window.saveUserInfo = function(userId) {
            // Implementation for saving user info
            showAlert('·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫', 'User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫ function ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'info');
        };

        // Approve User
        window.approveUser = async function(userId) {
            try {
                const pendingDocRef = doc(db, `artifacts/${app.options.projectId}/public/data/pending_profiles`, userId);
                const pendingSnap = await getDoc(pendingDocRef);
                
                if (!pendingSnap.exists()) {
                    return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', 'User ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´', 'error');
                }
                
                const userData = pendingSnap.data();
                
                const userDocRef = doc(db, `artifacts/${app.options.projectId}/users/${userId}/profile/data`);
                await updateDoc(userDocRef, { 
                    ...userData,
                    status: 'approved'
                });
                
                const publicContactRef = doc(db, `artifacts/${app.options.projectId}/public/data/public_contacts`, userId);
                await setDoc(publicContactRef, {
                    thaiPhoneNumber: userData.thaiPhoneNumber,
                    messengerLink: userData.messengerLink,
                    facebookLink: userData.facebookLink,
                    telegramLink: userData.telegramLink
                });
                
                await deleteDoc(pendingDocRef);
                
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', 'User ·ÄÄ·Ä≠·ÄØ ·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
                renderAdminPanel();
            } catch (error) {
                logStatus(`Approve User Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·ÄÅ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äï·Äº·ÄØ·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // Send Notification
        window.sendNotification = async function(event) {
            event.preventDefault();
            
            const title = document.getElementById('notification-title').value;
            const content = document.getElementById('notification-content').value;

            if (!title || !content) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'error');
            }

            try {
                const collectionRef = collection(db, `artifacts/${app.options.projectId}/public/data/notifications`);
                await addDoc(collectionRef, {
                    title,
                    content,
                    sentBy: currentUserEmail,
                    timestamp: Date.now()
                });
                
                document.getElementById('send-notification-form').reset();
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫ ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Send Notification Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äï·Ä≠·ÄØ·Ä∑·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // Delete Notification
        window.deleteNotification = async function(notificationId) {
            if (!confirm('·Ä§·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äô·Äæ·Ä¨ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?')) return;
            
            try {
                await deleteDoc(doc(db, `artifacts/${app.options.projectId}/public/data/notifications`, notificationId));
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫ ·Äñ·Äª·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Delete Notification Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äñ·Äª·ÄÄ·Ä∫·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // View: Notifications
        function renderNotifications() {
            const notifications = window.notificationsList || [];
            
            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏</h2>
                    <p class="text-gray-400">Admin ·Äô·Äæ ·Äï·Ä±·Ä∏·Äï·Ä≠·ÄØ·Ä∑·Äû·Ä±·Ä¨ ·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏</p>
                </div>
            `;
            
            if (notifications.length === 0) {
                contentDiv.innerHTML += `
                    <div class="glass-card p-8 text-center rounded-2xl">
                        <i class="fas fa-bell-slash text-4xl text-gray-500 mb-4"></i>
                        <h3 class="text-lg font-bold text-gray-400 mb-2">·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´</h3>
                        <p class="text-gray-500">·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äê·ÄΩ·ÄÑ·Ä∫ ·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</p>
                    </div>
                `;
                return;
            }

            notifications.forEach(noti => {
                const date = new Date(noti.timestamp).toLocaleString('my-MM', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const notificationCard = `
                    <div class="glass-card p-5 rounded-xl mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="text-lg font-bold text-white mb-1">${noti.title}</h3>
                                <div class="flex items-center text-sm text-gray-400">
                                    <i class="fas fa-user-shield mr-2"></i>
                                    <span>Admin</span>
                                    <i class="fas fa-clock mx-2"></i>
                                    <span>${date}</span>
                                </div>
                            </div>
                            ${isUserAdmin ? `
                                <button onclick="deleteNotification('${noti.id}')" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        <p class="text-gray-300 whitespace-pre-wrap">${noti.content}</p>
                    </div>
                `;
                contentDiv.innerHTML += notificationCard;
            });
        }

        // View: Car Rental
        function renderCarRental() {
            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äõ·Äî·Ä∫</h2>
                    <p class="text-gray-400">·Äö·ÄØ·Ä∂·ÄÄ·Äº·Ää·Ä∫·Äõ·Äû·Ä±·Ä¨ ·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏·Äô·Äª·Ä¨·Ä∏</p>
                </div>
            `;
            
            if (carRentalList.length === 0) {
                contentDiv.innerHTML += `
                    <div class="glass-card p-8 text-center rounded-2xl">
                        <i class="fas fa-car text-4xl text-gray-500 mb-4"></i>
                        <h3 class="text-lg font-bold text-gray-400 mb-2">·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äï·Ä´</h3>
                        <p class="text-gray-500">·Äú·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äê·ÄΩ·ÄÑ·Ä∫ ·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´</p>
                    </div>
                `;
                return;
            }

            carRentalList.forEach(car => {
                const carCard = `
                    <div class="glass-card p-5 rounded-xl mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-bold text-white mb-1">${car.name}</h3>
                                <div class="flex items-center text-gray-400">
                                    <i class="fas fa-phone mr-2"></i>
                                    <span>${car.phone}</span>
                                </div>
                            </div>
                            ${isUserAdmin ? `
                                <button onclick="deleteCarRental('${car.id}')" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="space-y-3">
                            ${car.messengerLink ? `
                                <div class="flex items-center">
                                    <i class="fab fa-facebook-messenger text-blue-500 mr-3 w-5"></i>
                                    <a href="${car.messengerLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all flex-1">
                                        ${car.messengerLink}
                                    </a>
                                </div>
                            ` : ''}
                            
                            ${car.telegramLink ? `
                                <div class="flex items-center">
                                    <i class="fab fa-telegram text-blue-400 mr-3 w-5"></i>
                                    <a href="${car.telegramLink}" target="_blank" class="text-blue-400 hover:text-blue-300 underline break-all flex-1">
                                        ${car.telegramLink}
                                    </a>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                contentDiv.innerHTML += carCard;
            });
        }

        // Add Car Rental
        window.addCarRental = async function(event) {
            event.preventDefault();
            
            const name = document.getElementById('car-name').value;
            const phone = document.getElementById('car-phone').value;
            const messenger = document.getElementById('car-messenger').value;
            const telegram = document.getElementById('car-telegram').value;

            try {
                const collectionRef = collection(db, `artifacts/${app.options.projectId}/public/data/car_rental`);
                await addDoc(collectionRef, {
                    name,
                    phone,
                    messengerLink: messenger,
                    telegramLink: telegram,
                    addedBy: currentUserEmail,
                    timestamp: Date.now()
                });
                
                document.getElementById('car-rental-form').reset();
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏ ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Add Car Rental Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // Delete Car Rental
        window.deleteCarRental = async function(carId) {
            if (!confirm('·Ä§·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äô·Äæ·Ä¨ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?')) return;
            
            try {
                await deleteDoc(doc(db, `artifacts/${app.options.projectId}/public/data/car_rental`, carId));
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·ÄÄ·Ä¨·Ä∏·ÄÑ·Äæ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏ ·Äñ·Äª·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
            } catch (error) {
                logStatus(`Delete Car Rental Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äñ·Äª·ÄÄ·Ä∫·Åç ·Äô·Äõ·Äï·Ä´', 'error');
            }
        };

        // View: Job Post Form
        function renderJobPostForm() {
            const posterName = currentUserProfile?.passportName || currentUserEmail;
            
            contentDiv.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">·Ä°·Äú·ÄØ·Äï·Ä∫·Äû·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫</h2>
                    <p class="text-gray-400">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·Äû·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äú·ÄΩ·Äö·Ä∫·ÄÄ·Ä∞·ÄÖ·ÄΩ·Ä¨ ·Äê·ÄÑ·Ä∫·Äï·Ä´</p>
                </div>
                
                <div class="glass-card p-6 rounded-2xl">
                    <form id="job-post-form" class="space-y-5" onsubmit="submitJobPost(event)">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <p class="text-sm text-gray-400 mb-1">·Äê·ÄÑ·Ä∫·Äû·Ä∞</p>
                            <p class="text-white font-medium">${posterName}</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·Äô·Ää·Ä∫</label>
                            <input type="text" id="job-title" required class="input-field w-full p-3" placeholder="·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·Äô·Ää·Ä∫">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Äê·Ää·Ä∫·Äî·Ä±·Äõ·Ä¨</label>
                            <input type="text" id="job-location" required class="input-field w-full p-3" placeholder="·Äò·Äî·Ä∫·ÄÄ·Ä±·Ä¨·ÄÄ·Ä∫·Åä ·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·Äô·Ä≠·ÄØ·ÄÑ·Ä∫">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·ÄÖ·Äô·Äê·Ä∫·ÄÅ (·Äò·Äê·Ä∫)</label>
                                <input type="number" id="job-smart-fee" required class="input-field w-full p-3" placeholder="1000" min="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·Äú·ÄÖ·Ä¨ ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏</label>
                                <input type="number" id="salary-min" required class="input-field w-full p-3" placeholder="10000" min="0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">·Äú·ÄÖ·Ä¨ ·Ä°·Äô·Äª·Ä¨·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏</label>
                                <input type="number" id="salary-max" required class="input-field w-full p-3" placeholder="20000" min="0">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫</label>
                            <textarea id="job-description" rows="4" required class="input-field w-full p-3" placeholder="·Ä°·Äú·ÄØ·Äï·Ä∫·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äô·Äª·Ä¨·Ä∏ (·Ä°·Äô·Äª·Ä¨·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÉ ·Äï·ÄØ·Ä∂)</label>
                            <input type="file" id="job-images-file" accept="image/*" multiple onchange="handleJobMediaChange(event, 'images')" class="input-field w-full p-2">
                            <p id="job-images-status" class="text-xs text-blue-400 mt-1">·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·ÅÅ ·Äï·ÄØ·Ä∂ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫</p>
                        </div>
                        
                        <button type="submit" class="btn-success w-full p-3">
                            <i class="fas fa-upload mr-2"></i>·Ä°·Äú·ÄØ·Äï·Ä∫·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫
                        </button>
                    </form>
                </div>
            `;
        }

        // Handle Job Media Change
        window.handleJobMediaChange = function(event, type) {
            const files = Array.from(event.target.files);
            const statusElement = document.getElementById(`job-${type}-status`);
            
            if (type === 'images') {
                if (files.length > 3) {
                    showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂ ·ÅÉ ·Äï·ÄØ·Ä∂·Ä°·Äë·Ä≠·Äû·Ä¨ ·Äê·ÄÑ·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'error');
                    event.target.value = '';
                    selectedJobImages = [];
                    statusElement.textContent = '·ÅÉ ·Äï·ÄØ·Ä∂·Ä°·Äë·Ä≠·Äû·Ä¨ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫';
                    return;
                }
                selectedJobImages = files;
                statusElement.textContent = `·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Äº·ÄÆ·Ä∏: ${files.length} ·Äï·ÄØ·Ä∂`;
            }
        };

        // Submit Job Post
        window.submitJobPost = async function(event) {
            event.preventDefault();
            
            const title = document.getElementById('job-title').value;
            const location = document.getElementById('job-location').value;
            const smartFee = parseInt(document.getElementById('job-smart-fee').value);
            const salaryMin = parseInt(document.getElementById('salary-min').value);
            const salaryMax = parseInt(document.getElementById('salary-max').value);
            const description = document.getElementById('job-description').value;

            if (isNaN(smartFee) || smartFee < 0) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·ÄÖ·Äô·Äê·Ä∫·ÄÅ ·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·ÄÖ·ÄΩ·Ä¨ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´', 'error');
            }

            if (isNaN(salaryMin) || isNaN(salaryMax) || salaryMin < 0 || salaryMax < 0 || salaryMin > salaryMax) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Äú·ÄÖ·Ä¨ ·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·ÄÖ·ÄΩ·Ä¨ ·Äñ·Äº·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´', 'error');
            }

            if (selectedJobImages.length === 0) {
                return showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂ ·ÅÅ ·Äï·ÄØ·Ä∂ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äï·Ä´', 'error');
            }

            try {
                showLoading();
                
                const imageUploadPromises = selectedJobImages.map(file => uploadToCloudinary(file));
                const uploadedImageUrls = await Promise.all(imageUploadPromises);
                
                const jobData = {
                    title,
                    location,
                    smartFee,
                    salaryMin,
                    salaryMax,
                    description,
                    media: {
                        images: uploadedImageUrls.filter(url => url)
                    },
                    postedBy: currentUserId,
                    postedByName: currentUserProfile?.passportName || currentUserEmail,
                    status: 'approved',
                    timestamp: Date.now()
                };

                const collectionRef = collection(db, `artifacts/${app.options.projectId}/public/data/jobs`);
                await addDoc(collectionRef, jobData);
                
                selectedJobImages = [];
                document.getElementById('job-post-form').reset();
                
                hideLoading();
                showAlert('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫', '·Ä°·Äú·ÄØ·Äï·Ä∫·Äê·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', 'success');
                setView('home');
            } catch (error) {
                hideLoading();
                logStatus(`Job Post Error: ${error.message}`, true);
                showAlert('·Ä°·Äô·Äæ·Ä¨·Ä∏', `·Äê·ÄÑ·Ä∫·Åç ·Äô·Äõ·Äï·Ä´: ${error.message}`, 'error');
            }
        };

        // Alert/Modal Function
        function showAlert(title, message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            let icon = 'fa-info-circle';
            let color = 'blue';
            
            if (type === 'success') {
                icon = 'fa-check-circle';
                color = 'green';
            } else if (type === 'error') {
                icon = 'fa-exclamation-circle';
                color = 'red';
            } else if (type === 'warning') {
                icon = 'fa-exclamation-triangle';
                color = 'yellow';
            }
            
            modal.innerHTML = `
                <div class="modal-content p-5">
                    <div class="text-center mb-4">
                        <i class="fas ${icon} text-${color}-500 text-4xl mb-3"></i>
                        <h3 class="text-lg font-bold text-white">${title}</h3>
                    </div>
                    <p class="text-gray-300 text-center mb-6">${message}</p>
                    <button onclick="this.closest('.modal-overlay').remove()" class="btn-primary w-full p-3">
                        ·Äî·Ä¨·Ä∏·Äú·Ää·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Initialize the application
        initFirebase();
    </script>
</body>
    </html>
